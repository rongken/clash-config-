enable_rule_generator=true
overwrite_original_rules=true

# 基础设置
exclude_remarks=(Data Left|Remain:|Traffic:|Expir[ey]|Reset|^\d[\d.]*\s*[MG]B(?![A-Za-z])|[:：]\s*\d[\d.]*\s*GB(?![A-Za-z])|剩[余餘]流量|流量[：:]|[到过過效]期|[时時][间間]|重置|分割线|残り使用容量|有効期限|リセット|🔰\s*(ID|HSD|SNI):|📝\s*Gói:|测试|临时|备用)

ruleset=国内,[]GEOSITE,private
ruleset=国内,[]GEOIP,private,no-resolve
ruleset=国内,https://raw.githubusercontent.com/rongken/clash-config-/refs/heads/main/Direct.list
ruleset=国内,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.list
ruleset=国内,[]GEOSITE,google-cn
ruleset=国内,[]GEOSITE,category-games@cn
ruleset=国内,https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/main/rule/Steam_CDN.list
ruleset=国内,[]GEOSITE,category-game-platforms-download
ruleset=国内,[]GEOSITE,category-public-tracker
ruleset=TikTok,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.list
ruleset=流媒体,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.list
ruleset=流媒体,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.list
ruleset=流媒体,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.list
ruleset=流媒体,https://raw.githubusercontent.com/rongken/ios_rule_script/master/rule/Clash/HBO/HBO.list
ruleset=国内,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.list
ruleset=国内,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/China/China.list
ruleset=国内,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs.list
ruleset=国内,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMedia/ChinaMedia.list
ruleset=国内,[]GEOSITE,cn
ruleset=国内,[]GEOIP,cn,no-resolve
ruleset=国外,[]FINAL


custom_proxy_group=AI`select`[]所有地区-自动`[]香港-自动`[]台湾-自动`[]日本-自动`[]新加坡-自动`[]韩国-自动`[]美国-自动`[]手动节点
custom_proxy_group=TikTok`select`[]所有地区-自动`[]香港-自动`[]台湾-自动`[]日本-自动`[]新加坡-自动`[]韩国-自动`[]美国-自动`[]手动节点
custom_proxy_group=流媒体`select`[]所有地区-自动`[]香港-自动`[]台湾-自动`[]日本-自动`[]新加坡-自动`[]韩国-自动`[]美国-自动`[]手动节点
custom_proxy_group=国外`select`[]所有地区-自动`[]香港-自动`[]台湾-自动`[]日本-自动`[]新加坡-自动`[]韩国-自动`[]美国-自动`[]手动节点
custom_proxy_group=国内`select`[]DIRECT`[]所有地区-自动`[]手动节点

custom_proxy_group=手动节点`select`.*
custom_proxy_group=所有地区-自动`url-test`.*`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=香港-自动`url-test`(香港|HK|Hong Kong)`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=台湾-自动`url-test`(台湾|TW|Taiwan)`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=日本-自动`url-test`(日本|JP|东京|大阪)`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=新加坡-自动`url-test`(新加坡|SG|Singapore)`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=韩国-自动`url-test`(韩国|KR|Korea)`https://www.gstatic.com/generate_204`30,200
custom_proxy_group=美国-自动`url-test`(美国|US|United States)`https://www.gstatic.com/generate_204`30,200

# TUN 配置优化
tun:
  enable: true
  stack: gvisor
  dns-hijack:
    - udp://0.0.0.0:53
    - tcp://0.0.0.0:53
  auto-route: true
  auto-detect-interface: true
  mtu: 1350
  strict-route: true
  endpoint-independent-nat: true
  include-uid-range: [1000-65535]

# DNS配置
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - '+.stun.*'
    - '+.msftncsi.com'
    - '+.ntp.org.cn'
    - '+.pool.ntp.org'
    - '+.(cmpassport.com|10010.com|189.cn)'
  nameserver:
    - 223.6.6.6
    - https://dns.alidns.com/dns-query
  fallback:
    - https://1.12.12.12/dns-query
    - https://dns.google/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 192.0.0.0/24
  nameserver-policy:
    '+.bilibili.com': 223.6.6.6
    '+.(taobao.com|tmall.com|alipay.com|alicdn.com|aliyun.com)': 223.6.6.6
    '+.(qq.com|tencent.com|weixin.com|wechat.com|weiyun.com)': 223.6.6.6
    '+.cn': 223.6.6.6
    '+.(google.com|youtube.com|github.com|facebook.com|x.com|instagram.com|netflix.com|discord.com|reddit.com|tiktok.com)': https://1.12.12.12/dns-query
  caching: true
  cache-size: 4096

  # 协议设置
max-udp-packet-size: 4096
http:
  max-connections-per-host: 16
  connection-pool-size: 256
  idle-timeout: 60
http2:
  max-concurrent-streams: 256
tls:
  fast-open: true
  reuse-session: true
  session-ticket: true
  session-cache-size: 512
  min-version: 1.2
  max-version: 1.3

# 地理数据文件
geox-url:
  geoip: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat
  geosite: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
  mmdb: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb
  asn: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb

geodata-mode: true
geodata-loader: memconservative
geoip-maxmind-compatibility: true

# Sniffer 配置优化
sniffer:
  enable: true
  force-dns-mapping: true
  override-destination: true
  sniffing: [tls, http]
  port-whitelist: [80, 443]
  skip-domain:
    - '*.cn'
    - '*.bilibili.com'
    - '*.taobao.com'
    - '*.qq.com'
  sniff-timeout: 1.0

profile:
  store-selected: true
  store-fake-ip: false
  
